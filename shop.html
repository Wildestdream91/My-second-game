<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Idle ARPG ‚Äî Campement</title>
  <link rel="stylesheet" href="css/style.css"/>
</head>
<body class="bg">

<header class="topbar">
  <h1>Campement</h1>
  <nav>
    <a href="index.html">S√©lection</a>
    <a href="game.html">Combat</a>
    <a href="inventory.html">Inventaire</a>
    <a href="shop.html" class="active">Campement</a>
    <a href="journal.html">Journal</a>
    <a href="ladder.html">Classement</a>
  </nav>
</header>

<main class="columns">
  <!-- Colonne gauche : Boutique -->
  <section class="panel">
    <h2>Boutique</h2>
    <div class="grid">
      <button class="btn" onclick="buyHP()">üß™ Potion de soin (20 or)</button>
      <button class="btn" onclick="buyMana()">üîÆ Potion de mana (20 or)</button>
      <button class="btn" onclick="buyCharm()">üçÄ Charme porte-bonheur (120 or)</button>
    </div>
    <p class="muted small">Les potions restaurent 35% de vos PV/Mana max.  
      Le charme donne +5% MF et a un ilvl bas√© sur votre niveau.</p>
  </section>

  <!-- Colonne droite : Infos joueur + Journal -->
  <aside class="panel">
    <div>
      <b id="pName">‚Äî</b> (Nv <span id="pLvl">1</span>)  
      ‚Äî Or: <span id="pGold">0</span>
    </div>
    <div class="bars">
      <div class="bar hp">
        <div class="bar-fill" id="barHpFill"></div>
        <div class="bar-text" id="barHpText">HP 0/0</div>
      </div>
      <div class="bar mana">
        <div class="bar-fill" id="barManaFill"></div>
        <div class="bar-text" id="barManaText">Mana 0/0</div>
      </div>
    </div>
    <h3>Journal</h3>
    <div id="logBox" class="logBox"></div>
  </aside>
</main>

<footer class="footnote">
  Achetez potions et charmes pour renforcer vos chances !
</footer>

<!-- Scripts -->
<script src="js/core.js"></script>
<script src="js/loot.js"></script>
<script>
  GameCore.ensureGameOrRedirect("index.html");

  function refresh(){
    const s=GameCore.state;
    document.getElementById("pName").textContent=s.name;
    document.getElementById("pLvl").textContent=s.level;
    document.getElementById("pGold").textContent=s.gold;
    document.getElementById("barHpFill").style.width=(s.hp/s.hpMax*100)+"%";
    document.getElementById("barHpText").textContent=`HP ${s.hp}/${s.hpMax}`;
    document.getElementById("barManaFill").style.width=(s.mana/s.manaMax*100)+"%";
    document.getElementById("barManaText").textContent=`Mana ${s.mana}/${s.manaMax}`;
    document.getElementById("logBox").innerHTML=GameCore.logsHTML();
  }
  function buy(cost, ok){
    const s=GameCore.state;
    if(s.gold<cost){ GameCore.log("Pas assez d‚Äôor."); refresh(); return; }
    s.gold-=cost; ok(); GameCore.save(); refresh();
  }
  function buyHP(){ buy(20, ()=>{
    const s=GameCore.state; const heal=Math.floor(s.hpMax*0.35);
    s.hp=Math.min(s.hpMax, s.hp+heal); GameCore.log(`üß™ +${heal} PV.`);
  });}
  function buyMana(){ buy(20, ()=>{
    const s=GameCore.state; const gain=Math.floor(s.manaMax*0.35);
    s.mana=Math.min(s.manaMax, s.mana+gain); GameCore.log(`üîÆ +${gain} Mana.`);
  });}
  function buyCharm(){ buy(120, ()=>{
    const ilvl = Loot.rollIlvl({source:"shop"});
    const charm={name:"Charme porte-bonheur",slot:"ring",rarity:"magique",atk:0,def:0,crit:0,mf:5,str:0,dex:0,vit:0,ene:0, ilvl};
    GameCore.state.inventory ||= []; GameCore.state.inventory.push(charm);
    GameCore.log(`üçÄ Charme (ilvl ${ilvl}) ajout√© √† l‚Äôinventaire.`);
  });}
  refresh();
</script>

</body>
</html>
