<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Idle ARPG v7 ‚Äî Campement</title>
  <link rel="stylesheet" href="css/style.css"/>
</head>
<body class="bg">

<header class="topbar">
  <h1>Idle ARPG ‚Äî Campement</h1>
  <nav>
    <a href="index.html">Cr√©ation</a>
    <a href="game.html">Combat</a>
    <a href="inventory.html">Inventaire</a>
    <a href="shop.html" class="active">Campement</a>
    <a href="journal.html">Journal</a>
    <a href="ladder.html">Classement</a>
  </nav>
</header>

<main class="columns">
  <section class="panel">
    <h3>Marchand</h3>
    <div class="shopRow">
      <div class="shopItem">
        <div class="title">Potion de vie (petite)</div>
        <div class="desc">Restaure 35% des PV max.</div>
        <div class="price">Prix : 20 or</div>
        <button class="btn" onclick="buyHP()">Acheter</button>
      </div>
      <div class="shopItem">
        <div class="title">Potion de mana (petite)</div>
        <div class="desc">Restaure 35% du mana max.</div>
        <div class="price">Prix : 20 or</div>
        <button class="btn" onclick="buyMana()">Acheter</button>
      </div>
      <div class="shopItem">
        <div class="title">Idole de chance</div>
        <div class="desc">+5% MF (bonus permanent l√©ger)</div>
        <div class="price">Prix : 120 or</div>
        <button class="btn" onclick="buyCharm()">Acheter</button>
      </div>
    </div>
  </section>

  <aside class="panel">
    <h3>H√©ros</h3>
    <div>Nom : <b id="pName">‚Äî</b> (Lv <span id="pLvl">1</span>)</div>
    <div>Or : <b id="pGold">0</b></div>
    <div class="bars small">
      <div class="bar hp"><div class="bar-fill" id="barHpFill"></div><div class="bar-text" id="barHpText">HP 0/0</div></div>
      <div class="bar mana"><div class="bar-fill" id="barManaFill"></div><div class="bar-text" id="barManaText">Mana 0/0</div></div>
    </div>
    <h3>Journal</h3>
    <div id="logBox" class="logBox"></div>
    <hr/>
    <button class="btn danger" onclick="GameCore.reset(true)">R√©initialiser la sauvegarde</button>
  </aside>
</main>

<script src="js/core.js"></script>
<script>
  GameCore.ensureGameOrRedirect?.("index.html");

  function refresh(){
    const s=GameCore.state;
    document.getElementById("pName").textContent = s.name;
    document.getElementById("pLvl").textContent = s.level;
    document.getElementById("pGold").textContent = s.gold;
    document.getElementById("barHpFill").style.width=(s.hp/s.hpMax*100)+"%";
    document.getElementById("barHpText").textContent=`HP ${s.hp}/${s.hpMax}`;
    document.getElementById("barManaFill").style.width=(s.mana/s.manaMax*100)+"%";
    document.getElementById("barManaText").textContent=`Mana ${s.mana}/${s.manaMax}`;
    document.getElementById("logBox").innerHTML=GameCore.logsHTML();
  }

  function buy(cost, onOK){
    const s=GameCore.state;
    if(s.gold < cost){ GameCore.log("Pas assez d‚Äôor."); refresh(); return; }
    s.gold -= cost;
    onOK();
    GameCore.save();
    refresh();
  }

  function buyHP(){
    buy(20, ()=>{
      const s=GameCore.state;
      const heal = Math.floor(s.hpMax*0.35);
      s.hp = Math.min(s.hpMax, s.hp + heal);
      GameCore.log(`üß™ Potion de vie utilis√©e (+${heal} PV).`);
    });
  }
  function buyMana(){
    buy(20, ()=>{
      const s=GameCore.state;
      const gain = Math.floor(s.manaMax*0.35);
      s.mana = Math.min(s.manaMax, s.mana + gain);
      GameCore.log(`üîÆ Potion de mana utilis√©e (+${gain} Mana).`);
    });
  }
  function buyCharm(){
    buy(120, ()=>{
      // Ajoute un petit charme MF (bonus passif simul√© par anneau greff√©)
      const charm = {name:"Charme porte-bonheur", slot:"ring", rarity:"magique", atk:0, def:0, crit:0, mf:5, str:0,dex:0,vit:0,ene:0};
      GameCore.state.inventory.push(charm);
      GameCore.log("üçÄ Charme +5% MF ajout√© √† l‚Äôinventaire (√©quipez-le).");
    });
  }

  refresh();
</script>
</body>
</html>
