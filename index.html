<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Idle ARPG — Sélection</title>
  <link rel="stylesheet" href="css/style.css"/>
</head>
<body class="bg">
<header class="topbar">
  <h1>Sélection de personnage</h1>
  <nav>
    <a href="index.html" class="active">Sélection</a>
    <a href="game.html">Combat</a>
    <a href="inventory.html">Inventaire</a>
    <a href="shop.html">Campement</a>
    <a href="journal.html">Journal</a>
    <a href="ladder.html">Classement</a>
    <a href="admin.html">Admin</a>
  </nav>
</header>

<main class="columns">
  <section class="panel">
    <h2>Créer un personnage</h2>

    <label style="display:block;margin-bottom:8px">Pseudo
      <input id="pName" type="text" placeholder="Ton pseudo..."/>
    </label>

    <label style="display:block;margin-bottom:8px">Classe
      <select id="pClass">
        <option value="Barbare">Barbare</option>
        <option value="Sorcieres">Sorcieres</option>
        <option value="Paladin">Paladin</option>
        <option value="Necromancien">Necromancien</option>
        <option value="Amazone">Amazone</option>
        <option value="Assassin">Assassin</option>
        <option value="Druide">Druide</option>
      </select>
    </label>

    <button class="btn primary" onclick="create()">Créer</button>
    <div class="muted small" style="margin-top:8px">
      La partie est sauvegardée dans ton navigateur (localStorage).
    </div>
  </section>
</main>

<script src="js/core.js"></script>
<script>
// Si une partie existe déjà → aller directement au jeu
(function autoRedirect(){
  try{
    const raw=localStorage.getItem("idleARPG_state");
    if(raw){ const st=JSON.parse(raw); if(st && st.name){ location.href="game.html"; } }
  }catch(_){}
})();

function create(){
  const n=document.getElementById("pName").value.trim();
  const c=document.getElementById("pClass").value;
  if(!n){ alert("Choisis un pseudo."); return; }

  GameCore.newGame(n, c);

  // Vérifie la sauvegarde
  const raw = localStorage.getItem("idleARPG_state");
  if(!raw){
    alert("⚠️ Sauvegarde impossible. Autorise le stockage local pour ce site.");
    return;
  }
  try{ JSON.parse(raw); }
  catch(e){
    alert("⚠️ Sauvegarde corrompue. On réinitialise…");
    localStorage.removeItem("idleARPG_state");
    return;
  }
  location.href="game.html";
}
</script>
</body>
</html>
