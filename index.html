<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Idle ARPG — Sélection</title>
  <link rel="stylesheet" href="css/style.css"/>
</head>
<body class="bg">
<header class="topbar">
  <h1>Sélection de personnage</h1>
  <nav>
    <a href="index.html" class="active">Sélection</a>
    <a href="game.html">Combat</a>
    <a href="inventory.html">Inventaire</a>
    <a href="shop.html">Campement</a>
    <a href="journal.html">Journal</a>
    <a href="ladder.html">Classement</a>
    <a href="admin.html">Admin</a>
  </nav>
</header>

<main class="columns">
  <section class="panel">
    <h2>Créer un personnage</h2>
    <label>Pseudo
      <input id="pName" type="text" placeholder="Ton pseudo..."/>
    </label>
    <button class="btn primary" onclick="create()">Créer</button>
    <div class="muted small" style="margin-top:8px">La partie est sauvegardée dans ton navigateur (localStorage).</div>
  </section>
</main>

<script src="js/core.js"></script>
<script>
function create(){
  const n=document.getElementById("pName").value.trim();
  if(!n){ alert("Choisis un pseudo."); return; }

  // crée & tente la sauvegarde
  GameCore.newGame(n);

  // vérifie que la sauvegarde existe bien
  const raw = localStorage.getItem("idleARPG_state");
  if(!raw){
    alert("⚠️ Sauvegarde impossible. Autorise le stockage local pour ce site.");
    return;
  }
  try{
    JSON.parse(raw);
  }catch(e){
    alert("⚠️ Sauvegarde corrompue, on réinitialise.");
    localStorage.removeItem("idleARPG_state");
    return;
  }
  // ok → go jeu
  location.href="game.html";
}
</script>
</body>
</html>
