<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Idle ARPG v6.0 FR ‚Äî Combat</title>
  <link rel="stylesheet" href="css/style.css"/>
</head>
<body class="bg">
<header class="topbar">
  <h1>Idle ARPG ‚Äî Combat</h1>
  <nav>
    <a href="index.html">Cr√©ation</a>
    <a href="game.html" class="active">Combat</a>
    <a href="inventory.html">Inventaire</a>
    <a href="shop.html">Campement</a>
    <a href="journal.html">Journal</a>
    <a href="ladder.html">Classement</a>
  </nav>
</header>

<!-- Mini-carte des actes -->
<div id="actMap"></div>

<main class="columns">
  <section class="panel">
    <!-- Infos h√©ros -->
    <div class="heroStats">
      <div><b id="pName">‚Äî</b> (Lv <span id="pLvl">1</span>) ‚Äî <span id="pClass"></span></div>
      <div>FOR <span id="pStr">0</span> ‚Äî DEX <span id="pDex">0</span> ‚Äî VIT <span id="pVit">0</span> ‚Äî √âNE <span id="pEne">0</span></div>
      <div>ATQ <span id="pAtk">0</span> ‚Äî DEF <span id="pDef">0</span> ‚Äî Crit <span id="pCrit">0</span>% | MF <span id="pMF">0</span>% | Or <span id="pGold">0</span></div>
      <div class="bars">
        <div class="bar hp"><div class="bar-fill" id="barHpFill"></div><div class="bar-text" id="barHpText">HP 0/0</div></div>
        <div class="bar mana"><div class="bar-fill" id="barManaFill"></div><div class="bar-text" id="barManaText">Mana 0/0</div></div>
        <div class="bar xp"><div class="bar-fill" id="barXpFill"></div><div class="bar-text" id="barXpText">XP 0/0</div></div>
      </div>
    </div>

    <!-- Choix de zone -->
    <div class="zoneRow">
      <label>Zone :
        <select id="zoneSelect"></select>
      </label>
      <button id="newEncounter" class="btn">Nouvelle rencontre</button>
      <label class="switch">
        <input id="autoToggle" type="checkbox"/>
        <span>Auto-combat (idle)</span>
      </label>
    </div>

    <!-- Carte ennemi -->
    <div class="enemyCard" id="enemyCard" hidden>
      <div><b id="eName">‚Äî</b> (Lv <span id="eLvl">1</span>)</div>
      <div>HP: <span id="eHP">0</span>/<span id="eHPmax">0</span> | DEF: <span id="eDef">‚Äî</span> | D√©g√¢ts: <span id="eDice">‚Äî</span></div>
      <div class="actions">
        <button id="attackBtn" class="btn primary">‚öîÔ∏è Attaquer</button>
        <button id="fleeBtn" class="btn">üèÉ Fuir</button>
      </div>
    </div>
    <progress id="eHpBar" value="0" max="1"></progress>

    <div id="actLore" class="lore"></div>
  </section>

  <!-- Journal -->
  <aside class="panel log">
    <h3>Journal</h3>
    <div id="logBox" class="logBox"></div>
  </aside>
</main>

<footer class="footnote">Boss requis pour progresser √† l‚Äôacte suivant.</footer>

<script src="js/core.js"></script>
<script src="js/loot.js"></script>
<script src="js/combat.js"></script>
<script>
  // V√©rifie que le joueur a un perso
  GameCore.ensureGameOrRedirect("index.html");

  // Rendu joueur
  function renderPlayer(){
    const s=GameCore.state;
    document.getElementById("pName").textContent=s.name;
    document.getElementById("pLvl").textContent=s.level;
    document.getElementById("pClass").textContent=s.cls;
    document.getElementById("pStr").textContent=s.str;
    document.getElementById("pDex").textContent=s.dex;
    document.getElementById("pVit").textContent=s.vit;
    document.getElementById("pEne").textContent=s.ene;
    document.getElementById("pGold").textContent=s.gold;
    document.getElementById("barHpFill").style.width=(s.hp/s.hpMax*100)+"%";
    document.getElementById("barHpText").textContent=`HP ${s.hp}/${s.hpMax}`;
    document.getElementById("barManaFill").style.width=(s.mana/s.manaMax*100)+"%";
    document.getElementById("barManaText").textContent=`Mana ${s.mana}/${s.manaMax}`;
    document.getElementById("barXpFill").style.width=(s.xp/s.xpToNext*100)+"%";
    document.getElementById("barXpText").textContent=`XP ${s.xp}/${s.xpToNext}`;
    document.getElementById("logBox").innerHTML=GameCore.logsHTML();
    Combat.renderActMap();
  }

  // Init combat
  Combat.initUI(renderPlayer);
</script>
</body>
</html>
