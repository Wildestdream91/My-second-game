<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Idle ARPG â€” Combat</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body class="bg">

  <header class="topbar">
    <h1>Idle Ladder Prototype</h1>
    <nav>
      <a href="index.html">SÃ©lection</a>
      <a href="game.html" class="active">Combat</a>
      <a href="inventory.html">Inventaire</a>
      <a href="shop.html">Campement</a>
      <a href="journal.html">Journal</a>
      <a href="ladder.html">Classement</a>
      <a href="admin.html">Admin</a>
      <button class="btn" onclick="GameCore.newGame()">Nouvelle partie</button>
    </nav>
  </header>

  <main class="columns" style="grid-template-columns:0.9fr 1.1fr;">
    <section class="panel">
      <h2>Personnage</h2>

      <div class="bars">
        <div class="bar hp">
          <div class="bar-fill" id="barHpFill" style="width:0%"></div>
          <div class="bar-text" id="barHpText">HP 0/0</div>
        </div>
        <div class="bar mana">
          <div class="bar-fill" id="barManaFill" style="width:0%"></div>
          <div class="bar-text" id="barManaText">Mana 0/0</div>
        </div>
        <div class="bar xp">
          <div class="bar-fill" id="barXpFill" style="width:0%"></div>
          <div class="bar-text" id="barXpText">XP 0/0</div>
        </div>
      </div>

      <div class="statsBox" style="margin-top:10px">
        <div>ATQ <b id="cAtk">0</b> â€¢ DEF <b id="cDef">0</b> â€¢ Crit <b id="cCrit">0</b>% â€¢ MF <b id="cMF">0</b>%</div>
      </div>

      <h3 style="margin-top:12px">Carte</h3>
      <div class="grid" style="grid-template-columns:1fr 1fr;gap:8px">
        <div>
          <label>Acte
            <select id="selAct"></select>
          </label>
        </div>
        <div>
          <label>Zone
            <select id="selZone"></select>
          </label>
        </div>
      </div>
      <div style="display:flex; gap:8px; margin-top:8px">
        <button class="btn primary" id="btnGo">Aller</button>
        <button class="btn" id="btnStop">Stop</button>
      </div>
    </section>

    <section class="panel">
      <h2>Combat</h2>
      <div id="enemyCard" class="enemyCard">
        <div class="muted">Aucun ennemi. Choisis une zone puis <b>Aller</b>.</div>
      </div>

      <h3 style="margin-top:12px">Journal</h3>
      <div id="log" class="logBox" aria-live="polite"></div>
    </section>
  </main>

  <script src="js/core.v3.js"></script>
  <script src="js/zones.js"></script>
  <script src="js/combat.js"></script>
  <script>
    (function () {
      GameCore.ensureGameOrRedirect("index.html");

      const selAct  = document.getElementById("selAct");
      const selZone = document.getElementById("selZone");

      // Remplir actes/zones avec cadenas (ðŸ”’) si verrouillÃ©s
      Zones.fillActs(selAct);
      function refreshZones(){
        Zones.fillZonesForAct(selAct, selZone, (zoneId)=>GameCore.canTravelTo(zoneId));
      }
      selAct.onchange = refreshZones;
      refreshZones();

      // Bouton Aller avec vÃ©rification de verrou
      document.getElementById("btnGo").onclick = () => {
        const z = selZone.value;
        if(!GameCore.canTravelTo(z)){
          alert("ðŸš« Waypoint verrouillÃ© : vaincs d'abord le boss de la zone prÃ©cÃ©dente (ou le boss d'acte).");
          return;
        }
        GameCore.state.currentZone = z;
        GameCore.save();
        if (window.Combat && Combat.spawn) Combat.spawn();
      };

      document.getElementById("btnStop").onclick = () => {
        if (window.Combat && Combat.toggleAuto) Combat.toggleAuto();
      };
    })();
  </script>
</body>
</html>
