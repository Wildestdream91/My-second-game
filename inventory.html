<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Idle ARPG — Inventaire & Fiche perso</title>
  <link rel="stylesheet" href="css/style.css"/>
</head>
<body class="bg">

<header class="topbar">
  <h1>Idle Ladder Prototype</h1>
  <nav>
    <a href="index.html">Sélection</a>
    <a href="game.html">Combat</a>
    <a href="inventory.html" class="active">Inventaire</a>
    <a href="shop.html">Campement</a>
    <a href="journal.html">Journal</a>
    <!-- <a href="ladder.html">Classement</a> -->
    <a href="admin.html">Admin</a>
    <button class="btn" onclick="GameCore.newGame()">Nouvelle partie</button>
  </nav>
</header>

<main class="columns" style="grid-template-columns: 0.9fr 1.1fr;">
  <section class="panel">
    <h2 style="margin-bottom:6px">Fiche de personnage</h2>
    <div style="margin-bottom:8px">
      <b id="cName">—</b>
      (<span id="cClass">—</span>) — Nv <span id="cLvl">1</span>
      • Or: <b id="cGold">0</b>
    </div>
    <div class="bars">
      <div class="bar hp">
        <div class="bar-fill" id="barHpFill"></div>
        <div class="bar-text" id="barHpText">HP 0/0</div>
      </div>
      <div class="bar mana">
        <div class="bar-fill" id="barManaFill"></div>
        <div class="bar-text" id="barManaText">Mana 0/0</div>
      </div>
      <div class="bar xp">
        <div class="bar-fill" id="barXpFill"></div>
        <div class="bar-text" id="barXpText">XP 0/0</div>
      </div>
    </div>
    <div class="statsBox" style="margin-top:10px">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <b>Caractéristiques</b>
        <span class="muted">Points restants: <b id="cPts">0</b></span>
      </div>
      <div class="grid" style="grid-template-columns:repeat(2,minmax(160px,1fr));gap:8px">
        <div>Force: <b id="cStr">0</b> <button class="btn" id="btnStr">+1</button></div>
        <div>Dextérité: <b id="cDex">0</b> <button class="btn" id="btnDex">+1</button></div>
        <div>Vitalité: <b id="cVit">0</b> <button class="btn" id="btnVit">+1</button></div>
        <div>Énergie: <b id="cEne">0</b> <button class="btn" id="btnEne">+1</button></div>
      </div>
    </div>

  <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap">
    <button class="btn" onclick="GameCore.exportSave()">Exporter la sauvegarde</button>
    <button class="btn" onclick="GameCore.importSave()">Importer une sauvegarde</button>
  </div>

  </section>

  <section class="panel">
    <h2>Équipement & Inventaire</h2>
    <div class="equipList" id="equipList"></div>
    <h3 style="margin-top:10px">Inventaire</h3>
    <div class="invList" id="invList"></div>
  </section>
</main>

<script src="js/core.v3.js"></script>
<script src="js/loot.js"></script>
<script>
(function(){
  GameCore.ensureGameOrRedirect("index.html");

  function sync(){
    const s = GameCore.state;
    document.getElementById('cName').textContent = s.name;
    document.getElementById('cClass').textContent = s.klass;
    document.getElementById('cLvl').textContent = s.level;
    document.getElementById('cGold').textContent = s.gold;
    // Bars
    const hpPct = Math.max(0, Math.min(100, Math.round((s.hp/s.hpMax)*100)));
    document.getElementById('barHpFill').style.width = hpPct+"%";
    document.getElementById('barHpText').textContent = `HP ${s.hp}/${s.hpMax}`;
    const mpPct = Math.max(0, Math.min(100, Math.round((s.mana/s.manaMax)*100)));
    document.getElementById('barManaFill').style.width = mpPct+"%";
    document.getElementById('barManaText').textContent = `Mana ${s.mana}/${s.manaMax}`;
    const xpMax = GameCore.xpTable[s.level] || 1;
    const xpPct = Math.max(0, Math.min(100, Math.round((s.xp/xpMax)*100)));
    document.getElementById('barXpFill').style.width = xpPct+"%";
    document.getElementById('barXpText').textContent = `XP ${s.xp}/${xpMax}`;
    // Stats
    document.getElementById('cPts').textContent = s.statPts;
    document.getElementById('cStr').textContent = s.str;
    document.getElementById('cDex').textContent = s.dex;
    document.getElementById('cVit').textContent = s.vit;
    document.getElementById('cEne').textContent = s.ene;
  }

  ['Str','Dex','Vit','Ene'].forEach(k=>{
    const id='btn'+k;
    const stat = k.toLowerCase();
    const el = document.getElementById(id);
    if(el) el.onclick = ()=>{ GameCore.spendStatPoint(stat); sync(); };
  });

  sync();
})();
</script>
</body>
</html>
